var needle = require("needle");

var apiId = "48bb4311";
var apiKey = "7f49df0097a6aead808d9c25e0dd3544";
var keywords = "ate had drank and with an a";

var sms = "tell tranquility I ate a pizza for breakfast";
var foodItem = "";

parse(sms);

function parse(sms) {
		var message = sms.split(" ");
		for (i = 0; i < message.length; i++) {
				if (keywords.indexOf(message[i]) > -1) {
						if (keywords.indexOf(message[i+1]) > -1) {
								foodItem = message[i+2];
								console.log(foodItem);
								apiCall(url(foodItem));
								if (keywords.indexOf(message[i+3]) > -1) {
										foodItem = message[i+4];
										console.log(foodItem);
										apiCall(url(foodItem));
								}
								break;
						}
						foodItem = message[i+1];
						console.log(foodItem);
						apiCall(url(foodItem));
				}
		}
}

function apiCall(url) {
		needle.get(url, function(error, response) {
		  	if (!error && response.statusCode == 200)
		  			var response = response.body;
		  	var title = response['hits'][0]['fields']['nf_calories'];
		  	console.log(title);
		});
}

function url(foodItem) {
		return "https://api.nutritionix.com/v1_1/search/"+foodItem+"?results=0%3A1&cal_min=0&cal_max=50000&fields=nf_calories&appId="+apiId+"&appKey="+apiKey;
}



// calories only
// "https://api.nutritionix.com/v1_1/search/"+foodItem+"?results=0%3A1&cal_min=0&cal_max=50000&fields=nf_calories&appId="+apiId+"&appKey="+apiKey;
// all fields
// "https://api.nutritionix.com/v1_1/search/"+foodItem+"?results=0%3A1&cal_min=0&cal_max=50000&fields=*&appId="+apiId+"&appKey="+apiKey;






